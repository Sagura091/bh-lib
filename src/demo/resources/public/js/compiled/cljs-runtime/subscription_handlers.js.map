{"version":3,"sources":["subscription_handlers.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db","day8.re-frame.tracing/is-trace-enabled?","p__47107","vec__47108","cljs.core.nth","+debux-dbg-opts+","day8.re-frame.debux.common.util/send-form!","result__35734__auto__","taoensso.timbre._log_BANG_","taoensso.timbre/*config*","cljs.core/Delay","day8.re-frame.debux.common.util/send-trace!","e","e47111","p__47116","vec__47117","db","_","id","cljs.core.assoc","js/subscription-handlers","js/subscription-handlers.event-msg-handler","method-table__4747__auto__","cljs.core.atom","prefer-table__4748__auto__","method-cache__4749__auto__","cached-hierarchy__4750__auto__","hierarchy__4751__auto__","cljs.core.get","fexpr__47121","cljs.core/MultiFn","cljs.core.symbol","subscription-handlers/event-msg-handler","p__47122","map__47123","cljs.core/--destructure-map","event","p__47126","map__47127","?data","msg","data-source-handler/data-source-msg-handler","p__47133","map__47134","ev-msg","vec__47135","old-state-map","new-state-map","re-frame.core/dispatch-sync","p__47139","map__47140","vec__47153","?uid","?csrf-token","?handshake-data","p__47159","map__47160"],"sourcesContent":["(ns subscription-handlers\n  (:require [re-frame.core :as rf]\n            [taoensso.timbre :as log]\n            [data-source-handler :as dh]\n            [day8.re-frame.tracing :refer-macros [fn-traced]]))\n\n\n(rf/reg-event-db\n  ::fully-opened-socket-start\n  (fn-traced [db [_ id]]\n             (log/info \"::sub-handler/fully-opened-websocket-start\" id)\n             (assoc db :pub-sub-started? true)))\n\n(defmulti event-msg-handler :id)\n\n(defmethod event-msg-handler :default\n  [{:keys [event]}]\n  (log/info \"Unhandled event:\" event))\n\n\n(defmethod event-msg-handler :chsk/recv\n  [{:keys [_ ?data] :as msg}]\n\n  ;(log/info \"Push event from server:\" ?data)\n  (dh/data-source-msg-handler ?data))\n\n(defmethod event-msg-handler :chsk/state\n  [{:as ev-msg :keys [?data]}]\n  (let [[old-state-map new-state-map] ?data]\n    (if (:first-open? new-state-map)\n      (do (rf/dispatch-sync [::fully-opened-socket-start])\n          (log/info \"Channel socket successfully established!: \" new-state-map))\n      (log/info \"Channel socket state change: \" new-state-map))))\n\n(defmethod event-msg-handler :chsk/handshake\n  [{:as ev-msg :keys [?data]}]\n  (let [[?uid ?csrf-token ?handshake-data] ?data]\n    (log/info \"WS Handshake for: \" ?uid \" data: \" ?handshake-data)))\n\n(defmethod event-msg-handler :chsk/ws-ping\n  [{:keys [event]}]\n  (log/info \"WS Ping\"))\n\n"]}